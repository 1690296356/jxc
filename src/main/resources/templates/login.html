<!DOCTYPE html >
<html  lang="en" class="login-content" data-ng-app="materialAdmin" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8"/>
<title>后台登录-进销存管理系统</title>
<meta name="author" content="DeathGhost" />
    <link rel="stylesheet" type="text/css" th:href="@{/static/css/style.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/static/css/login.css}" />
    <script src="/static/js/jquery.js"></script>
    <script src="/static/js/verifyCode.js"></script>
    <script src="/static/js/Particleground.js"></script>
<script type="text/javascript">
    /*<![CDATA[*/

    $(document).ready(function() {
        //粒子背景特效
        $('body').particleground({
            dotColor: '#5cbdaa',
            lineColor: '#5cbdaa'
        });

        $("#loginBtn").click(function (){
                   $.post("/user/login",
                       {"userName":$("#userName").val(),"password":$("#password").val(),"pImageCode":$("#imageCode").val()},
                       function (data) {
                            if(data.success){
                               if(data.roleSize==1){
                                    var roleId = data.roleList[0].id;
                                    $.post("/user/save/role",
                                        {pRoleId:roleId},
                                    function(data){
                                        if(data.success){
                                            window.location.href="/main";
                                        }
                                    })
                               }else {
                                   $("#roleList").empty();
                                   var roles = data.roleList;
                                   for (var i=0;i<roles.length;i++){
                                       if(i==0){
                                           $("#roleList").append("<input type='radio' checked=true name='role' value='"+roles[i].id+"'/>"+roles[i].name+"&nbsp;&nbsp;");
                                       }else{
                                           $("#roleList").append("<input type='radio' name='role' value='"+roles[i].id+"'/>"+roles[i].name+"&nbsp;&nbsp;");
                                       }
                                       $("#light").attr("style","display:block");
                                       $("#fade").attr("style","display:block");
                                   }
                               }
                            }else{
                                alert(data.errorInfo);
                            }
                        });
     });
    });

    function saveRole(){
        var roleId = $("input[name='role']:checked").val();
        $.post("/user/save/role",
            {pRoleId:roleId},
            function(data){
                if(data.success){
                    window.location.href="/main";
                }
            })
    }


    /*]]>*/
</script>
</head>
<body>
<dl class="admin_login">
 <dt>
  <strong>进销存管理系统</strong>
  <em>Lnvoicing Management System</em>
 </dt>
 <dd class="user_icon">
  <input type="text" id="userName" placeholder="账号" class="login_txtbx"/>
 </dd>
 <dd class="pwd_icon">
  <input type="password" id="password" placeholder="密码" class="login_txtbx"/>
 </dd>
  <dd class="val_icon">
  <div class="checkcode">
    <input type="text" id="imageCode" name="imageCode" placeholder="验证码" maxlength="4" class="login_txtbx" />
    <img id="imgObj" title="看不清，换一张" src="/drawImage" onclick="changeImg()" />
  </div>
 </dd>
 <dd>
  <input type="button" id="loginBtn" value="立即登录" class="submit_btn"/>
 </dd>
 <dd>
  <p>© 2012-2017 xxxx有限公司  版权所有</p>
  <p><a href="http://blog.thomas8341.com" target="_blank">托马斯之家 </a></p>
 </dd>
</dl>
	<div id="light" class="white_content"> 
          <p>请选择一个角色登录系统</p>
          <br/>
          <div id="roleList">
          </div>
          <br/>
          <input type="button" value="提交" onclick="saveRole()"/>
	</div> 
<div id="fade" class="black_overlay"> 
</div> 
</body>
</html>
